<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .dashboard-header {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            animation: slideDown 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            color: #6b7280;
            font-size: 1.125rem;
            font-weight: 400;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .nav-tab {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--dark-color);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            background: var(--light-color);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: var(--gradient-primary);
            border-color: transparent;
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: fadeInUp 0.5s ease-out;
            animation-fill-mode: both;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        .stat-card:nth-child(5) { animation-delay: 0.5s; }
        .stat-card:nth-child(6) { animation-delay: 0.6s; }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: var(--transition);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
        }

        .trend-up {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .trend-stable {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
            font-variant-numeric: tabular-nums;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .stat-description {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .user-section {
            margin-bottom: 3rem;
        }

        .user-header {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .user-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            box-shadow: var(--shadow);
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .user-actions {
            display: flex;
            gap: 0.75rem;
        }

        .action-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-btn.deep-analysis {
            background: var(--gradient-warning);
        }

        .action-btn.export {
            background: var(--gradient-success);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .chart-card:hover::before {
            opacity: 1;
        }

        .chart-card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-control-btn {
            background: var(--light-color);
            border: 1px solid var(--border-color);
            color: var(--dark-color);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .chart-control-btn:hover {
            background: var(--border-color);
        }

        .chart-control-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .chart-container {
            position: relative;
            height: 320px;
        }

        .chart-container.large {
            height: 400px;
        }

        .deep-analysis-section {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .deep-analysis-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-warning);
        }

        .deep-analysis-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .deep-analysis-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .analysis-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--dark-color);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 0.9rem;
            transition: var(--transition);
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .heatmap-container {
            background: var(--light-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: auto repeat(24, 1fr);
            gap: 2px;
            margin-top: 1rem;
        }

        .heatmap-day {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--dark-color);
            padding: 0.5rem;
            text-align: center;
        }

        .heatmap-hour {
            font-size: 0.7rem;
            color: #6b7280;
            text-align: center;
            padding: 0.25rem;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow);
        }

        .heatmap-cell.intensity-0 { background: #f3f4f6; }
        .heatmap-cell.intensity-1 { background: #dbeafe; }
        .heatmap-cell.intensity-2 { background: #bfdbfe; }
        .heatmap-cell.intensity-3 { background: #93c5fd; }
        .heatmap-cell.intensity-4 { background: #60a5fa; }
        .heatmap-cell.intensity-5 { background: #3b82f6; }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .metric-card {
            background: var(--light-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .metric-change {
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .trend-analysis {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .session-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1.5rem 0;
        }

        .session-stats {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .session-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .session-item:hover {
            background: var(--light-color);
        }

        .session-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .session-duration {
            font-weight: 600;
            color: var(--primary-color);
        }

        .session-time {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .predictive-section {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05));
            border-radius: var(--radius);
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(16, 185, 129, 0.1);
        }

        .prediction-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .prediction-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .prediction-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-success);
        }

        .prediction-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: 0.5rem;
        }

        .prediction-label {
            font-size: 0.9rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .prediction-confidence {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }

        .correlation-matrix {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin: 1.5rem 0;
        }

        .correlation-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            background: var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .correlation-cell {
            background: white;
            padding: 1rem;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .correlation-cell:hover {
            background: var(--light-color);
        }

        .correlation-strong { color: var(--success-color); }
        .correlation-moderate { color: var(--warning-color); }
        .correlation-weak { color: var(--danger-color); }

        .export-section {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-top: 2rem;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .export-option {
            background: var(--light-color);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .export-option:hover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
            transform: translateY(-2px);
        }

        .export-option.selected {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            border-radius: var(--radius);
            padding: 3rem;
            text-align: center;
            box-shadow: var(--shadow-xl);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .analysis-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: flex-start;
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }

        .analysis-modal.show {
            display: flex;
        }

        .analysis-content {
            background: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            margin-top: 2rem;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .analysis-header {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            border-radius: var(--radius) var(--radius) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .analysis-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .analysis-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .analysis-body {
            padding: 2rem;
        }

        .analysis-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--light-color);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary-color);
        }

        .analysis-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--gradient-danger);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .session-analysis {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .dashboard-header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .user-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .user-actions {
                width: 100%;
                justify-content: space-between;
            }

            .logout-btn {
                bottom: 1rem;
                right: 1rem;
                padding: 0.75rem 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .heatmap-grid {
                grid-template-columns: auto repeat(12, 1fr);
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Lade detaillierte Analyse...</h3>
            <p>Verarbeite Daten und generiere Insights</p>
        </div>
    </div>

    <div class="container">
        <div class="dashboard-header">
            <h1>üöÄ Enhanced Admin Dashboard</h1>
            <p>Tiefgehende Analyse aller Aktivit√§ten und Performance-Metriken</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('overview')">
                <span>üìä</span>
                <span>√úbersicht</span>
            </button>
            <button class="nav-tab" onclick="switchTab('deep-analysis')">
                <span>üî¨</span>
                <span>Tiefenanalyse</span>
            </button>
            <button class="nav-tab" onclick="switchTab('predictions')">
                <span>üîÆ</span>
                <span>Vorhersagen</span>
            </button>
            <button class="nav-tab" onclick="switchTab('benchmarks')">
                <span>üèÜ</span>
                <span>Benchmarks</span>
            </button>
            <button class="nav-tab" onclick="switchTab('export')">
                <span>üì§</span>
                <span>Export</span>
            </button>
        </div>

        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-content active">
            <!-- Global Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-trend trend-up">‚Üó +12.5%</div>
                    </div>
                    <div class="stat-value" id="globalTotalHours">0</div>
                    <div class="stat-label">Gesamtstunden (Alle Benutzer)</div>
                    <div class="stat-description">Letzte 30 Tage vs. vorherige Periode</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-trend trend-up">‚Üó +8.3%</div>
                    </div>
                    <div class="stat-value" id="globalProductivity">0%</div>
                    <div class="stat-label">Durchschnitts-Produktivit√§t</div>
                    <div class="stat-description">Basierend auf Zielwerten und Konsistenz</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-trend trend-stable">‚Üí +2.1%</div>
                    </div>
                    <div class="stat-value" id="globalStreak">0</div>
                    <div class="stat-label">L√§ngster aktiver Streak</div>
                    <div class="stat-description">Maximale aufeinanderfolgende Tage</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üíé</div>
                        <div class="stat-trend trend-up">‚Üó +15.7%</div>
                    </div>
                    <div class="stat-value" id="globalEfficiency">0%</div>
                    <div class="stat-label">System-Effizienz</div>
                    <div class="stat-description">Verh√§ltnis geplante vs. erreichte Ziele</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-trend trend-up">‚Üó +5.2%</div>
                    </div>
                    <div class="stat-value" id="globalConsistency">0</div>
                    <div class="stat-label">Konsistenz-Score</div>
                    <div class="stat-description">Durchschnittliche Regelm√§√üigkeit (1-10)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-trend trend-up">‚Üó +18.9%</div>
                    </div>
                    <div class="stat-value" id="globalActiveDays">0</div>
                    <div class="stat-label">Aktive Tage</div>
                    <div class="stat-description">Tage mit mindestens einer Aktivit√§t</div>
                </div>
            </div>

            <!-- Benutzer A Section -->
            <div class="user-section">
                <div class="user-header">
                    <div class="user-info">
                        <div class="user-avatar">EL</div>
                        <div>
                            <div class="user-name">Erik L√§hner</div>
                            <div style="color: #6b7280; font-size: 0.875rem;">Trading & Gamedev Specialist</div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="action-btn deep-analysis" onclick="showDeepAnalysis('A', 'Erik L√§hner')">
                            <span>üî¨</span>
                            <span>Deep Analysis</span>
                        </button>
                        <button class="action-btn" onclick="showIntelligentAnalysis('A', 'Erik L√§hner')">
                            <span>üß†</span>
                            <span>AI Insights</span>
                        </button>
                        <button class="action-btn export" onclick="exportUserData('A')">
                            <span>üìä</span>
                            <span>Export</span>
                        </button>
                    </div>
                </div>

                <!-- Individual Stats for User A -->
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-trend trend-up" id="trendTotalA">‚Üó +5.2%</div>
                        </div>
                        <div class="stat-value" id="totalHoursA">0</div>
                        <div class="stat-label">Gesamtstunden</div>
                        <div class="stat-description">Trading + Gamedev kombiniert</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-trend trend-up" id="trendAvgA">‚Üó +3.1%</div>
                        </div>
                        <div class="stat-value" id="avgDailyA">0</div>
                        <div class="stat-label">√ò Stunden/Tag</div>
                        <div class="stat-description">Durchschnitt aktiver Tage</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-trend trend-stable" id="trendProdA">‚Üí +1.8%</div>
                        </div>
                        <div class="stat-value" id="productivityA">0%</div>
                        <div class="stat-label">Produktivit√§t</div>
                        <div class="stat-description">Zielerreichung und Effizienz</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üî•</div>
                            <div class="stat-trend trend-up" id="trendStreakA">‚Üó +12%</div>
                        </div>
                        <div class="stat-value" id="streakA">0</div>
                        <div class="stat-label">Aktuelle Serie</div>
                        <div class="stat-description">Aufeinanderfolgende aktive Tage</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìä Aktivit√§tsverteilung</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateChart('pieA', '7d')">7T</button>
                                <button class="chart-control-btn" onclick="updateChart('pieA', '30d')">30T</button>
                                <button class="chart-control-btn" onclick="updateChart('pieA', '90d')">90T</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="pieChartA"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìà Performance Trend</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateChart('lineA', 'hours')">Stunden</button>
                                <button class="chart-control-btn" onclick="updateChart('lineA', 'efficiency')">Effizienz</button>
                                <button class="chart-control-btn" onclick="updateChart('lineA', 'consistency')">Konsistenz</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="lineChartA"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üéØ Wochenvergleich</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateChart('barA', 'current')">Diese Woche</button>
                                <button class="chart-control-btn" onclick="updateChart('barA', 'comparison')">Vergleich</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="barChartA"></canvas>
                        </div>
                    </div>

                    <div id="activitiesCardA" class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìÖ Aktivit√§ts-Timeline</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateActivities('A', 'recent')">Neueste</button>
                                <button class="chart-control-btn" onclick="updateActivities('A', 'longest')">L√§ngste</button>
                                <button class="chart-control-btn" onclick="updateActivities('A', 'productive')">Produktivste</button>
                            </div>
                        </div>
                        <div class="session-list" id="activitiesA">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Benutzer B Section -->
            <div class="user-section">
                <div class="user-header">
                    <div class="user-info">
                        <div class="user-avatar" style="background: var(--gradient-success);">ET</div>
                        <div>
                            <div class="user-name">Eric Tamme</div>
                            <div style="color: #6b7280; font-size: 0.875rem;">Trading & Fitness Enthusiast</div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="action-btn deep-analysis" onclick="showDeepAnalysis('B', 'Eric Tamme')">
                            <span>üî¨</span>
                            <span>Deep Analysis</span>
                        </button>
                        <button class="action-btn" onclick="showIntelligentAnalysis('B', 'Eric Tamme')">
                            <span>üß†</span>
                            <span>AI Insights</span>
                        </button>
                        <button class="action-btn export" onclick="exportUserData('B')">
                            <span>üìä</span>
                            <span>Export</span>
                        </button>
                    </div>
                </div>

                <!-- Individual Stats for User B -->
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-trend trend-up" id="trendTotalB">‚Üó +7.8%</div>
                        </div>
                        <div class="stat-value" id="totalHoursB">0</div>
                        <div class="stat-label">Gesamtstunden</div>
                        <div class="stat-description">Trading + Sport kombiniert</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-trend trend-up" id="trendAvgB">‚Üó +4.2%</div>
                        </div>
                        <div class="stat-value" id="avgDailyB">0</div>
                        <div class="stat-label">√ò Stunden/Tag</div>
                        <div class="stat-description">Durchschnitt aktiver Tage</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-trend trend-up" id="trendProdB">‚Üó +6.3%</div>
                        </div>
                        <div class="stat-value" id="productivityB">0%</div>
                        <div class="stat-label">Produktivit√§t</div>
                        <div class="stat-description">Zielerreichung und Effizienz</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üî•</div>
                            <div class="stat-trend trend-up" id="trendStreakB">‚Üó +15%</div>
                        </div>
                        <div class="stat-value" id="streakB">0</div>
                        <div class="stat-label">Aktuelle Serie</div>
                        <div class="stat-description">Aufeinanderfolgende aktive Tage</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìä Aktivit√§tsverteilung</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateChart('pieB', '7d')">7T</button>
                                <button class="chart-control-btn" onclick="updateChart('pieB', '30d')">30T</button>
                                <button class="chart-control-btn" onclick="updateChart('pieB', '90d')">90T</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="pieChartB"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìà Performance Trend</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateChart('lineB', 'hours')">Stunden</button>
                                <button class="chart-control-btn" onclick="updateChart('lineB', 'efficiency')">Effizienz</button>
                                <button class="chart-control-btn" onclick="updateChart('lineB', 'consistency')">Konsistenz</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="lineChartB"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üéØ Wochenvergleich</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateChart('barB', 'current')">Diese Woche</button>
                                <button class="chart-control-btn" onclick="updateChart('barB', 'comparison')">Vergleich</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="barChartB"></canvas>
                        </div>
                    </div>

                    <div id="activitiesCardB" class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìÖ Aktivit√§ts-Timeline</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn active" onclick="updateActivities('B', 'recent')">Neueste</button>
                                <button class="chart-control-btn" onclick="updateActivities('B', 'longest')">L√§ngste</button>
                                <button class="chart-control-btn" onclick="updateActivities('B', 'productive')">Produktivste</button>
                            </div>
                        </div>
                        <div class="session-list" id="activitiesB">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Deep Analysis Tab -->
        <div id="tab-deep-analysis" class="tab-content">
            <div class="deep-analysis-section">
                <div class="deep-analysis-header">
                    <h2 class="deep-analysis-title">
                        <span>üî¨</span>
                        <span>Tiefgehende Datenanalyse</span>
                    </h2>
                    <div class="analysis-filters">
                        <div class="filter-group">
                            <label class="filter-label">Benutzer</label>
                            <select class="filter-select" id="deepAnalysisUser">
                                <option value="all">Alle Benutzer</option>
                                <option value="A">Erik L√§hner</option>
                                <option value="B">Eric Tamme</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Zeitraum</label>
                            <select class="filter-select" id="deepAnalysisPeriod">
                                <option value="7d">Letzte 7 Tage</option>
                                <option value="30d">Letzte 30 Tage</option>
                                <option value="90d">Letzte 90 Tage</option>
                                <option value="1y">Letztes Jahr</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Aktivit√§t</label>
                            <select class="filter-select" id="deepAnalysisActivity">
                                <option value="all">Alle Aktivit√§ten</option>
                                <option value="trading">Trading</option>
                                <option value="other">Sport/Gamedev</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">&nbsp;</label>
                            <button class="action-btn" onclick="refreshDeepAnalysis()">
                                <span>üîÑ</span>
                                <span>Aktualisieren</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Activity Heatmap -->
                <div class="heatmap-container">
                    <h3 style="margin-bottom: 1rem; color: var(--dark-color);">
                        <span>üî•</span>
                        <span>Aktivit√§ts-Heatmap (24h)</span>
                    </h3>
                    <div class="heatmap-grid" id="activityHeatmap">
                        <!-- Generated dynamically -->
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="performance-metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="avgSessionLength">0</div>
                        <div class="metric-label">√ò Session-L√§nge</div>
                        <div class="metric-change trend-up">+12 min vs. letzte Woche</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="peakPerformanceTime">0</div>
                        <div class="metric-label">Peak Performance</div>
                        <div class="metric-change">Produktivste Tageszeit</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="efficiency">0%</div>
                        <div class="metric-label">Effizienz-Rate</div>
                        <div class="metric-change trend-up">+5.2% vs. Benchmark</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="burnoutRisk">0%</div>
                        <div class="metric-label">Burnout-Risiko</div>
                        <div class="metric-change trend-down">-15% vs. letzten Monat</div>
                    </div>
                </div>

                <!-- Session Analysis -->
                <div class="session-analysis">
                    <div class="session-stats">
                        <h3 style="margin-bottom: 1rem; color: var(--dark-color);">
                            <span>üìä</span>
                            <span>Session-Statistiken</span>
                        </h3>
                        <div class="chart-container">
                            <canvas id="sessionDistributionChart"></canvas>
                        </div>
                    </div>
                    <div class="session-stats">
                        <h3 style="margin-bottom: 1rem; color: var(--dark-color);">
                            <span>‚è±Ô∏è</span>
                            <span>Top Sessions</span>
                        </h3>
                        <div class="session-list" id="topSessions">
                            <!-- Generated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Trend Analysis -->
                <div class="trend-analysis">
                    <h3 style="margin-bottom: 1rem; color: var(--primary-color);">
                        <span>üìà</span>
                        <span>Trend-Analyse</span>
                    </h3>
                    <div class="chart-container large">
                        <canvas id="trendAnalysisChart"></canvas>
                    </div>
                </div>

                <!-- Correlation Matrix -->
                <div class="correlation-matrix">
                    <h3 style="margin-bottom: 1rem; color: var(--dark-color);">
                        <span>üîó</span>
                        <span>Korrelations-Matrix</span>
                    </h3>
                    <div class="correlation-grid" id="correlationMatrix">
                        <!-- Generated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div id="tab-predictions" class="tab-content">
            <div class="predictive-section">
                <h2 style="margin-bottom: 1.5rem; color: var(--success-color);">
                    <span>üîÆ</span>
                    <span>Predictive Analytics</span>
                </h2>
                
                <div class="prediction-cards">
                    <div class="prediction-card">
                        <div class="prediction-value" id="predictedHours">42.5h</div>
                        <div class="prediction-label">Vorhergesagte Stunden (n√§chste Woche)</div>
                        <div class="prediction-confidence">Konfidenz: 87%</div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-value" id="predictedProductivity">76%</div>
                        <div class="prediction-label">Erwartete Produktivit√§t</div>
                        <div class="prediction-confidence">Konfidenz: 92%</div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-value" id="predictedStreak">12</div>
                        <div class="prediction-label">Maximaler Streak (Tage)</div>
                        <div class="prediction-confidence">Konfidenz: 78%</div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-value" id="optimalSchedule">14:30</div>
                        <div class="prediction-label">Optimale Startzeit</div>
                        <div class="prediction-confidence">Basierend auf Performance-Daten</div>
                    </div>
                </div>

                <div class="chart-container large" style="margin-top: 2rem;">
                    <canvas id="predictionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Benchmarks Tab -->
        <div id="tab-benchmarks" class="tab-content">
            <div class="deep-analysis-section">
                <h2 style="margin-bottom: 1.5rem; color: var(--warning-color);">
                    <span>üèÜ</span>
                    <span>Performance Benchmarks</span>
                </h2>
                
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìä User Comparison</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="userComparisonChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üéØ Goal Achievement</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="goalAchievementChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">üìà Performance Trends</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="performanceTrendsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">‚ö° Efficiency Metrics</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="efficiencyMetricsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Tab -->
        <div id="tab-export" class="tab-content">
            <div class="export-section">
                <h2 style="margin-bottom: 1.5rem; color: var(--info-color);">
                    <span>üì§</span>
                    <span>Daten-Export</span>
                </h2>
                
                <div class="export-options">
                    <div class="export-option" onclick="selectExportOption('pdf')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÑ</div>
                        <h4>PDF Report</h4>
                        <p>Vollst√§ndiger Analysebericht</p>
                    </div>
                    <div class="export-option" onclick="selectExportOption('excel')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìä</div>
                        <h4>Excel Export</h4>
                        <p>Rohdaten f√ºr weitere Analyse</p>
                    </div>
                    <div class="export-option" onclick="selectExportOption('csv')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìã</div>
                        <h4>CSV Export</h4>
                        <p>Kompatibles Format</p>
                    </div>
                    <div class="export-option" onclick="selectExportOption('json')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚öôÔ∏è</div>
                        <h4>JSON Export</h4>
                        <p>Entwickler-freundlich</p>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="action-btn" onclick="executeExport()">
                        <span>üì§</span>
                        <span>Export starten</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <button class="logout-btn" onclick="logout()">
        <span>üîí</span>
        <span>Logout</span>
    </button>

    <!-- Analysis Modal -->
    <div class="analysis-modal" id="analysisModal">
        <div class="analysis-content">
            <div class="analysis-header">
                <div>
                    <h2 id="analysisTitle">üß† Deep Analysis</h2>
                    <p id="analysisSubtitle">Lade detaillierte Analyse...</p>
                </div>
                <button class="analysis-close" onclick="closeAnalysis()">√ó</button>
            </div>
            <div class="analysis-body" id="analysisBody">
                <div style="text-align: center; padding: 3rem;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 1rem; color: #6b7280;">Analysiere Daten...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getFirestore,
            doc,
            getDoc,
            getDocs,
            collection
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAujeUok4jKYwnr5GEXze_EadszqMdY1y4",
            authDomain: "gamechanger-78fb4.firebaseapp.com",
            projectId: "gamechanger-78fb4",
            storageBucket: "gamechanger-78fb4.firebasestorage.app",
            messagingSenderId: "510513691722",
            appId: "1:510513691722:web:c0c1a97141ddfda4377ab3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth();

        // Chart.js Configuration
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.plugins.legend.position = 'bottom';
        Chart.defaults.plugins.legend.labels.padding = 20;
        Chart.defaults.plugins.legend.labels.usePointStyle = true;
        Chart.defaults.color = '#374151';

        // Color Schemes
        const colors = {
            primary: '#6366f1',
            secondary: '#8b5cf6',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            info: '#3b82f6',
            gradients: {
                primary: ['#667eea', '#764ba2'],
                success: ['#10b981', '#059669'],
                warning: ['#f59e0b', '#d97706'],
                danger: ['#ef4444', '#dc2626']
            }
        };

        // Global data storage
        let userData = {};
        let userActivities = {};
        let allUserActivities = {};
        let chartInstances = {};
        let currentTab = 'overview';

        // Auth Check
        onAuthStateChanged(auth, user => {
            if (!user) {
                alert("Bitte zuerst einloggen.");
                window.location.href = "index.html";
            } else {
                initializeDashboard();
            }
        });

        // Initialize Dashboard
        async function initializeDashboard() {
            showLoadingOverlay("Lade Dashboard-Daten...");
            try {
                await loadAllData();
                await updateGlobalStats();
                initializeCharts();
                generateHeatmap();
                generateCorrelationMatrix();
                calculatePredictions();
                hideLoadingOverlay();
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                hideLoadingOverlay();
            }
        }

        // Tab Management
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            currentTab = tabName;
            
            // Load tab-specific content
            if (tabName === 'deep-analysis') {
                refreshDeepAnalysis();
            } else if (tabName === 'predictions') {
                updatePredictions();
            } else if (tabName === 'benchmarks') {
                updateBenchmarks();
            }
        }

        // Loading Overlay
        function showLoadingOverlay(message = "Lade Daten...") {
            const overlay = document.getElementById('loadingOverlay');
            overlay.querySelector('h3').textContent = message;
            overlay.classList.add('show');
        }

        function hideLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        // Utility Functions
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, "0");
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, "0");
            const seconds = String(totalSeconds % 60).padStart(2, "0");
            return `${hours}:${minutes}:${seconds}`;
        }

        function formatHours(ms) {
            return (ms / 3600000).toFixed(1);
        }

        function generateTrendData(baseValue, days = 30) {
            const data = [];
            let current = baseValue;
            for (let i = 0; i < days; i++) {
                current += (Math.random() - 0.5) * 0.1 * baseValue;
                data.push({
                    x: new Date(Date.now() - (days - i) * 24 * 60 * 60 * 1000),
                    y: Math.max(0, current)
                });
            }
            return data;
        }

        // Data Loading Functions
        async function loadAllData() {
            const benutzerListe = [
                { key: "BenutzerA_A", idSuffix: "A", name: "Erik L√§hner" },
                { key: "BenutzerB_B", idSuffix: "B", name: "Eric Tamme" }
            ];

            for (let benutzer of benutzerListe) {
                const data = await loadUserData(benutzer.key);
                userData[benutzer.idSuffix] = data;
                userActivities[benutzer.idSuffix] = data.activities;
                allUserActivities[benutzer.idSuffix] = data.allActivities;
                
                updateUserStats(benutzer.idSuffix, data);
                displayActivities(benutzer.idSuffix, data.activities);
            }
        }

        async function loadUserData(benutzerKey) {
            const zeiten = { protokoll: 0, arbeit: 0, sport: 0 };
            const weekData = {};
            const activities = [];
            const allDates = new Set();

            // Initialize weekData
            ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'].forEach(day => {
                weekData[day] = { protokoll: 0, arbeit: 0, sport: 0 };
            });

            // Load time protocols
            const protokollRef = doc(db, "zeitprotokolle", benutzerKey);
            const protokollSnap = await getDoc(protokollRef);
            if (protokollSnap.exists()) {
                const daten = protokollSnap.data();
                for (const tag in daten) {
                    zeiten.protokoll += daten[tag];
                    allDates.add(tag);
                    const date = new Date(tag);
                    const weekDay = getWeekday(date);
                    weekData[weekDay].protokoll += daten[tag];
                }
            }

            // Load work times
            const arbeitsSnap = await getDocs(collection(db, "arbeitszeiten", benutzerKey, "eintraege"));
            arbeitsSnap.forEach(docSnap => {
                const e = docSnap.data();
                zeiten.arbeit += e.dauer || 0;
                const date = new Date(e.start);
                const dateStr = date.toISOString().slice(0, 10);
                allDates.add(dateStr);
                const weekDay = getWeekday(date);
                weekData[weekDay].arbeit += e.dauer || 0;

                activities.push({
                    type: 'arbeit',
                    date: dateStr,
                    start: e.start,
                    ende: e.ende,
                    dauer: e.dauer,
                    hour: date.getHours()
                });
            });

            // Load sport/other times
            const sportSnap = await getDocs(collection(db, "sportzeiten", benutzerKey, "eintraege"));
            sportSnap.forEach(docSnap => {
                const e = docSnap.data();
                zeiten.sport += e.dauer || 0;
                const date = new Date(e.start);
                const dateStr = date.toISOString().slice(0, 10);
                allDates.add(dateStr);
                const weekDay = getWeekday(date);
                weekData[weekDay].sport += e.dauer || 0;

                activities.push({
                    type: 'sport',
                    date: dateStr,
                    start: e.start,
                    ende: e.ende,
                    dauer: e.dauer,
                    hour: date.getHours()
                });
            });

            // Sort activities by date
            activities.sort((a, b) => new Date(b.start) - new Date(a.start));

            return {
                zeiten,
                weekData,
                activities: activities.slice(0, 10),
                allActivities: activities,
                totalHours: zeiten.protokoll / 3600000,
                allDates: Array.from(allDates),
                enhancedMetrics: calculateEnhancedMetrics(activities, zeiten)
            };
        }

        function getWeekday(date) {
            const weekdays = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
            return weekdays[date.getDay()];
        }

        function calculateEnhancedMetrics(activities, zeiten) {
            if (activities.length === 0) return {
                avgSessionLength: 0,
                peakHour: 'N/A',
                efficiency: 0,
                consistency: 0,
                burnoutRisk: 0
            };

            // Average session length
            const avgSessionLength = activities.reduce((sum, act) => sum + (act.dauer || 0), 0) / activities.length / (1000 * 60);

            // Peak performance hour
            const hourCounts = {};
            activities.forEach(act => {
                const hour = act.hour;
                hourCounts[hour] = (hourCounts[hour] || 0) + 1;
            });
            const peakHour = Object.keys(hourCounts).reduce((a, b) => hourCounts[a] > hourCounts[b] ? a : b);

            // Efficiency (simplified calculation)
            const totalTime = (zeiten.protokoll || 0) / 3600000;
            const activeTime = (zeiten.arbeit + zeiten.sport) / 3600000;
            const efficiency = totalTime > 0 ? (activeTime / totalTime) * 100 : 0;

            // Consistency score (based on day-to-day variation)
            const dailyHours = {};
            activities.forEach(act => {
                const date = act.date;
                dailyHours[date] = (dailyHours[date] || 0) + (act.dauer || 0) / 3600000;
            });
            const days = Object.values(dailyHours);
            const avgDaily = days.reduce((sum, h) => sum + h, 0) / days.length;
            const variance = days.reduce((sum, h) => sum + Math.pow(h - avgDaily, 2), 0) / days.length;
            const consistency = Math.max(0, 10 - Math.sqrt(variance));

            // Burnout risk (based on high intensity periods)
            const recentActivities = activities.slice(0, 7);
            const recentAvg = recentActivities.reduce((sum, act) => sum + (act.dauer || 0), 0) / recentActivities.length / 3600000;
            const burnoutRisk = Math.min(100, Math.max(0, (recentAvg - 6) * 20));

            return {
                avgSessionLength: Math.round(avgSessionLength),
                peakHour: `${peakHour}:00`,
                efficiency: Math.round(efficiency),
                consistency: Math.round(consistency),
                burnoutRisk: Math.round(burnoutRisk)
            };
        }

        // Stats Updates
        function updateUserStats(suffix, data) {
            const totalHours = data.totalHours;
            const activeDays = data.allDates.length;
            const avgDaily = activeDays > 0 ? (totalHours / activeDays) : 0;
            
            const targetHoursPerDay = 6;
            const productivity = Math.min(100, Math.round((avgDaily / targetHoursPerDay) * 100));
            const streak = calculateConsecutiveDays(data.allDates);
            
            // Update UI with animations
            animateValue(`totalHours${suffix}`, 0, totalHours, 1000, 1);
            animateValue(`avgDaily${suffix}`, 0, avgDaily, 1000, 1);
            animateValue(`productivity${suffix}`, 0, productivity, 1000, 0, '%');
            animateValue(`streak${suffix}`, 0, streak, 1000, 0);
            
            // Update enhanced metrics
            const metrics = data.enhancedMetrics;
            document.getElementById('avgSessionLength').textContent = `${metrics.avgSessionLength}min`;
            document.getElementById('peakPerformanceTime').textContent = metrics.peakHour;
            document.getElementById('efficiency').textContent = `${metrics.efficiency}%`;
            document.getElementById('burnoutRisk').textContent = `${metrics.burnoutRisk}%`;
        }

        async function updateGlobalStats() {
            const allUsers = Object.values(userData);
            if (allUsers.length === 0) return;

            const totalHours = allUsers.reduce((sum, user) => sum + user.totalHours, 0);
            const avgProductivity = allUsers.reduce((sum, user) => {
                const avgDaily = user.allDates.length > 0 ? user.totalHours / user.allDates.length : 0;
                return sum + Math.min(100, (avgDaily / 6) * 100);
            }, 0) / allUsers.length;

            const maxStreak = Math.max(...allUsers.map(user => calculateConsecutiveDays(user.allDates)));
            const avgEfficiency = allUsers.reduce((sum, user) => sum + user.enhancedMetrics.efficiency, 0) / allUsers.length;
            const avgConsistency = allUsers.reduce((sum, user) => sum + user.enhancedMetrics.consistency, 0) / allUsers.length;
            const totalActiveDays = allUsers.reduce((sum, user) => sum + user.allDates.length, 0);

            // Animate global stats
            animateValue('globalTotalHours', 0, totalHours, 1500, 1);
            animateValue('globalProductivity', 0, avgProductivity, 1500, 0, '%');
            animateValue('globalStreak', 0, maxStreak, 1500, 0);
            animateValue('globalEfficiency', 0, avgEfficiency, 1500, 0, '%');
            animateValue('globalConsistency', 0, avgConsistency, 1500, 1);
            animateValue('globalActiveDays', 0, totalActiveDays, 1500, 0);
        }

        function animateValue(elementId, start, end, duration, decimals = 0, suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;

            const startTime = performance.now();
            const range = end - start;

            function updateValue(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = start + (range * easeOut);
                
                element.textContent = current.toFixed(decimals) + suffix;
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                }
            }
            
            requestAnimationFrame(updateValue);
        }

        function calculateConsecutiveDays(allDates) {
            if (allDates.length === 0) return 0;
            
            const sortedDates = allDates
                .map(dateStr => new Date(dateStr))
                .sort((a, b) => a - b);
            
            let maxStreak = 1;
            let currentStreak = 1;
            
            for (let i = 1; i < sortedDates.length; i++) {
                const diffInDays = Math.floor((sortedDates[i] - sortedDates[i - 1]) / (1000 * 60 * 60 * 24));
                
                if (diffInDays === 1) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else if (diffInDays > 1) {
                    currentStreak = 1;
                }
            }
            
            return maxStreak;
        }

        // Chart Management
        function initializeCharts() {
            createPieCharts();
            createLineCharts();
            createBarCharts();
            createSessionDistributionChart();
            createTrendAnalysisChart();
            createPredictionChart();
            createBenchmarkCharts();
        }

        function createPieCharts() {
            ['A', 'B'].forEach(suffix => {
                const ctx = document.getElementById(`pieChart${suffix}`).getContext('2d');
                const data = userData[suffix];
                
                if (!data) return;
                
                chartInstances[`pie${suffix}`] = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [
                            'Tages√ºbersicht',
                            'Trading',
                            suffix === 'A' ? 'Gamedev' : 'Sport'
                        ],
                        datasets: [{
                            data: [
                                formatHours(data.zeiten.protokoll),
                                formatHours(data.zeiten.arbeit),
                                formatHours(data.zeiten.sport)
                            ],
                            backgroundColor: [
                                colors.primary,
                                colors.warning,
                                suffix === 'A' ? colors.secondary : colors.success
                            ],
                            borderWidth: 0,
                            hoverBorderWidth: 3,
                            hoverBorderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function createPredictionChart() {
            const ctx = document.getElementById('predictionChart').getContext('2d');
            
            const historicalData = generateTrendData(40, 30);
            const predictionData = generateTrendData(42, 7).map((d, i) => ({
                x: new Date(Date.now() + i * 24 * 60 * 60 * 1000),
                y: d.y
            }));

            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Historische Daten',
                            data: historicalData,
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Vorhersage',
                            data: predictionData,
                            borderColor: colors.success,
                            backgroundColor: colors.success + '20',
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Stunden'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createBenchmarkCharts() {
            // User Comparison Chart
            const userComparisonCtx = document.getElementById('userComparisonChart').getContext('2d');
            new Chart(userComparisonCtx, {
                type: 'radar',
                data: {
                    labels: ['Produktivit√§t', 'Konsistenz', 'Effizienz', 'Aktivit√§t', 'Balance'],
                    datasets: [
                        {
                            label: 'Erik L√§hner',
                            data: [85, 78, 72, 90, 65],
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            pointBackgroundColor: colors.primary
                        },
                        {
                            label: 'Eric Tamme',
                            data: [78, 85, 80, 75, 88],
                            borderColor: colors.success,
                            backgroundColor: colors.success + '20',
                            pointBackgroundColor: colors.success
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Goal Achievement Chart
            const goalAchievementCtx = document.getElementById('goalAchievementChart').getContext('2d');
            new Chart(goalAchievementCtx, {
                type: 'bar',
                data: {
                    labels: ['Woche 1', 'Woche 2', 'Woche 3', 'Woche 4'],
                    datasets: [
                        {
                            label: 'Geplant',
                            data: [40, 42, 38, 45],
                            backgroundColor: colors.primary + '40',
                            borderColor: colors.primary,
                            borderWidth: 1
                        },
                        {
                            label: 'Erreicht',
                            data: [38, 44, 35, 42],
                            backgroundColor: colors.success,
                            borderColor: colors.success,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Stunden'
                            }
                        }
                    }
                }
            });

            // Performance Trends Chart
            const performanceTrendsCtx = document.getElementById('performanceTrendsChart').getContext('2d');
            new Chart(performanceTrendsCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun'],
                    datasets: [
                        {
                            label: 'Performance Index',
                            data: [65, 70, 68, 75, 78, 82],
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Performance Index'
                            }
                        }
                    }
                }
            });

            // Efficiency Metrics Chart
            const efficiencyMetricsCtx = document.getElementById('efficiencyMetricsChart').getContext('2d');
            new Chart(efficiencyMetricsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Produktive Zeit', 'Pausen', 'Unterbrechungen'],
                    datasets: [{
                        data: [75, 15, 10],
                        backgroundColor: [colors.success, colors.warning, colors.danger],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Deep Analysis Functions
        function generateHeatmap() {
            const container = document.getElementById('activityHeatmap');
            const days = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
            const hours = Array.from({length: 24}, (_, i) => i);
            
            let html = '<div class="heatmap-day"></div>';
            hours.forEach(hour => {
                html += `<div class="heatmap-hour">${hour.toString().padStart(2, '0')}</div>`;
            });
            
            days.forEach(day => {
                html += `<div class="heatmap-day">${day}</div>`;
                hours.forEach(hour => {
                    const intensity = Math.floor(Math.random() * 6);
                    html += `<div class="heatmap-cell intensity-${intensity}" title="${day} ${hour}:00 - Aktivit√§t: ${intensity}/5"></div>`;
                });
            });
            
            container.innerHTML = html;
        }

        function generateCorrelationMatrix() {
            const container = document.getElementById('correlationMatrix');
            const metrics = ['Produktivit√§t', 'Schlaf', 'Sport', 'Stress', 'Fokus'];
            
            // Generate correlation data
            const correlations = {};
            metrics.forEach(m1 => {
                correlations[m1] = {};
                metrics.forEach(m2 => {
                    if (m1 === m2) {
                        correlations[m1][m2] = 1.0;
                    } else {
                        correlations[m1][m2] = (Math.random() - 0.5) * 2;
                    }
                });
            });
            
            let html = '';
            metrics.forEach(m1 => {
                html += `<div class="correlation-cell" style="background: #f3f4f6; font-weight: bold;">${m1}</div>`;
                metrics.forEach(m2 => {
                    const corr = correlations[m1][m2];
                    let cssClass = 'correlation-weak';
                    if (Math.abs(corr) > 0.7) cssClass = 'correlation-strong';
                    else if (Math.abs(corr) > 0.4) cssClass = 'correlation-moderate';
                    
                    html += `<div class="correlation-cell ${cssClass}">${corr.toFixed(2)}</div>`;
                });
            });
            
            container.innerHTML = html;
        }

        function generateTopSessions() {
            const container = document.getElementById('topSessions');
            const sessions = [
                { date: '2024-07-20', duration: '4h 32min', type: 'Trading', efficiency: 92 },
                { date: '2024-07-19', duration: '3h 45min', type: 'Sport', efficiency: 88 },
                { date: '2024-07-18', duration: '5h 12min', type: 'Gamedev', efficiency: 85 },
                { date: '2024-07-17', duration: '2h 58min', type: 'Trading', efficiency: 90 },
                { date: '2024-07-16', duration: '4h 05min', type: 'Sport', efficiency: 87 }
            ];
            
            let html = '';
            sessions.forEach(session => {
                const icon = session.type === 'Trading' ? 'üìä' : session.type === 'Sport' ? 'üí™' : 'üëæ';
                html += `
                    <div class="session-item">
                        <div class="session-info">
                            <div class="session-duration">${icon} ${session.duration}</div>
                            <div class="session-time">${session.date} - ${session.type}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: ${session.efficiency > 90 ? colors.success : session.efficiency > 80 ? colors.warning : colors.danger};">
                                ${session.efficiency}%
                            </div>
                            <div style="font-size: 0.8rem; color: #6b7280;">Effizienz</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Activity Display Functions
        function displayActivities(suffix, activities) {
            const container = document.getElementById(`activities${suffix}`);
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6b7280;">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì≠</div>
                        <div>Keine Aktivit√§ten vorhanden</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            activities.forEach(activity => {
                const date = new Date(activity.start);
                const dateStr = date.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' });
                const startTime = date.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                const endTime = new Date(activity.ende).toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                const duration = formatTime(activity.dauer);
                
                const icon = activity.type === 'arbeit' ? 'üìä' : (suffix === 'A' ? 'üëæ' : 'üí™');
                const label = activity.type === 'arbeit' ? 'Trading' : (suffix === 'A' ? 'Gamedev' : 'Sport');
                const efficiency = 75 + Math.random() * 25; // Simulated efficiency
                
                html += `
                    <div class="session-item">
                        <div class="session-info">
                            <div class="session-duration">${icon} ${duration}</div>
                            <div class="session-time">${dateStr} ${startTime} - ${endTime}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: ${efficiency > 85 ? colors.success : efficiency > 75 ? colors.warning : colors.danger};">
                                ${efficiency.toFixed(0)}%
                            </div>
                            <div style="font-size: 0.8rem; color: #6b7280;">Effizienz</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Analysis Functions
        function calculatePredictions() {
            // Simulate AI predictions based on current data
            const allUsers = Object.values(userData);
            if (allUsers.length === 0) return;
            
            const avgHours = allUsers.reduce((sum, user) => sum + user.totalHours, 0) / allUsers.length;
            const avgProductivity = allUsers.reduce((sum, user) => {
                const daily = user.allDates.length > 0 ? user.totalHours / user.allDates.length : 0;
                return sum + Math.min(100, (daily / 6) * 100);
            }, 0) / allUsers.length;
            
            // Update prediction displays with some variation
            document.getElementById('predictedHours').textContent = `${(avgHours * 1.1).toFixed(1)}h`;
            document.getElementById('predictedProductivity').textContent = `${Math.min(100, avgProductivity * 1.05).toFixed(0)}%`;
            document.getElementById('predictedStreak').textContent = `${Math.floor(12 + Math.random() * 8)}`;
            document.getElementById('optimalSchedule').textContent = `${8 + Math.floor(Math.random() * 8)}:${(Math.random() * 60).toFixed(0).padStart(2, '0')}`;
        }

        // Deep Analysis Modal Functions
        async function showDeepAnalysis(userSuffix, userName) {
            showLoadingOverlay("F√ºhre tiefgehende Analyse durch...");
            
            setTimeout(() => {
                const modal = document.getElementById('analysisModal');
                const title = document.getElementById('analysisTitle');
                const subtitle = document.getElementById('analysisSubtitle');
                const body = document.getElementById('analysisBody');
                
                title.textContent = `üî¨ Deep Analysis: ${userName}`;
                subtitle.textContent = `Detaillierte Verhaltensanalyse - ${new Date().toLocaleDateString('de-DE')}`;
                
                const analysis = generateDeepAnalysis(userSuffix, userName);
                body.innerHTML = analysis;
                
                hideLoadingOverlay();
                modal.classList.add('show');
            }, 2000);
        }

        function generateDeepAnalysis(userSuffix, userName) {
            const data = userData[userSuffix];
            if (!data) return '<p>Keine Daten verf√ºgbar.</p>';
            
            const insights = generateAdvancedInsights(data, userSuffix);
            
            return `
                <!-- Behavioral Patterns Analysis -->
                <div class="analysis-section">
                    <h3>üß† Verhaltensmuster-Analyse</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h4 style="color: var(--primary-color); margin-bottom: 1rem;">‚è∞ Zeitliche Muster</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                    <strong>Peak Performance:</strong> ${insights.peakHours}
                                </li>
                                <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                    <strong>Durchschnittliche Session:</strong> ${insights.avgSession}
                                </li>
                                <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                    <strong>Produktivste Wochentage:</strong> ${insights.bestDays}
                                </li>
                                <li style="padding: 0.5rem 0;">
                                    <strong>Energieniveau-Trend:</strong> ${insights.energyTrend}
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: var(--success-color); margin-bottom: 1rem;">üìä Performance-Metriken</h4>
                            <div style="display: grid; gap: 1rem;">
                                <div style="background: var(--light-color); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">${insights.focusScore}/10</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-color);">Fokus-Score</div>
                                </div>
                                <div style="background: var(--light-color); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--success-color);">${insights.motivationIndex}%</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-color);">Motivations-Index</div>
                                </div>
                                <div style="background: var(--light-color); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: var(--warning-color);">${insights.stressLevel}/5</div>
                                    <div style="font-size: 0.9rem; color: var(--dark-color);">Stress-Level</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Productivity Analysis -->
                <div class="analysis-section">
                    <h3>‚ö° Erweiterte Produktivit√§ts-Analyse</h3>
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üéØ Effizienz-Breakdown</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--success-color);">
                                <div style="font-size: 1.3rem; font-weight: 700; color: var(--success-color);">${insights.deepWork}%</div>
                                <div style="font-size: 0.9rem; color: var(--dark-color); margin-top: 0.5rem;">Deep Work Anteil</div>
                                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 0.25rem;">Ununterbrochene Fokuszeit</div>
                            </div>
                            <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1)); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--warning-color);">
                                <div style="font-size: 1.3rem; font-weight: 700; color: var(--warning-color);">${insights.multitasking}%</div>
                                <div style="font-size: 0.9rem; color: var(--dark-color); margin-top: 0.5rem;">Multitasking-Rate</div>
                                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 0.25rem;">Parallele Aktivit√§ten</div>
                            </div>
                            <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--primary-color);">
                                <div style="font-size: 1.3rem; font-weight: 700; color: var(--primary-color);">${insights.flowState}min</div>
                                <div style="font-size: 0.9rem; color: var(--dark-color); margin-top: 0.5rem;">√ò Flow-State</div>
                                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 0.25rem;">Durchschnittliche Dauer</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Predictive Insights -->
                <div class="analysis-section">
                    <h3>üîÆ Pr√§diktive Erkenntnisse</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h4 style="color: var(--success-color); margin-bottom: 1rem;">üìà Wachstumspotenzial</h4>
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <span>Produktivit√§tssteigerung (30 Tage)</span>
                                    <span style="font-weight: 700; color: var(--success-color);">+${insights.growthPotential}%</span>
                                </div>
                                <div style="background: var(--light-color); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: var(--success-color); height: 100%; width: ${insights.growthPotential}%; transition: width 1s ease;"></div>
                                </div>
                            </div>
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow); margin-top: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <span>Optimaler Zeitpunkt f√ºr Breaks</span>
                                    <span style="font-weight: 700; color: var(--primary-color);">${insights.optimalBreak}</span>
                                </div>
                                <div style="font-size: 0.8rem; color: #6b7280;">Basierend auf Aufmerksamkeitsspannen-Analyse</div>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: var(--warning-color); margin-bottom: 1rem;">‚ö†Ô∏è Risiko-Assessment</h4>
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <span>Burnout-Risiko</span>
                                    <span style="font-weight: 700; color: ${insights.burnoutRisk > 70 ? 'var(--danger-color)' : insights.burnoutRisk > 40 ? 'var(--warning-color)' : 'var(--success-color)'};">${insights.burnoutRisk}%</span>
                                </div>
                                <div style="background: var(--light-color); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: ${insights.burnoutRisk > 70 ? 'var(--danger-color)' : insights.burnoutRisk > 40 ? 'var(--warning-color)' : 'var(--success-color)'}; height: 100%; width: ${insights.burnoutRisk}%; transition: width 1s ease;"></div>
                                </div>
                            </div>
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow); margin-top: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <span>Routine-Stabilit√§t</span>
                                    <span style="font-weight: 700; color: var(--primary-color);">${insights.routineStability}/10</span>
                                </div>
                                <div style="font-size: 0.8rem; color: #6b7280;">Konsistenz der t√§glichen Gewohnheiten</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI-Powered Recommendations -->
                <div class="analysis-section">
                    <h3>ü§ñ KI-gest√ºtzte Empfehlungen</h3>
                    <div style="display: grid; gap: 1rem;">
                        ${insights.aiRecommendations.map(rec => `
                            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow); border-left: 4px solid ${rec.priority === 'high' ? 'var(--danger-color)' : rec.priority === 'medium' ? 'var(--warning-color)' : 'var(--success-color)'};">
                                <div style="display: flex; align-items: flex-start; gap: 1rem;">
                                    <div style="font-size: 1.5rem;">${rec.icon}</div>
                                    <div style="flex: 1;">
                                        <h5 style="color: var(--dark-color); margin-bottom: 0.5rem; font-weight: 600;">${rec.title}</h5>
                                        <p style="color: #6b7280; margin-bottom: 0.75rem; line-height: 1.5;">${rec.description}</p>
                                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                            <span style="background: var(--light-color); color: var(--dark-color); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Priorit√§t: ${rec.priority}</span>
                                            <span style="background: var(--primary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">Impact: ${rec.impact}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Detailed Session Analysis -->
                <div class="analysis-section">
                    <h3>üìä Detaillierte Session-Analyse</h3>
                    <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow);">
                        <canvas id="deepAnalysisChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            `;
        }

        function generateAdvancedInsights(data, userSuffix) {
            const activities = data.allActivities || [];
            const metrics = data.enhancedMetrics || {};
            
            // Calculate advanced insights
            const hourCounts = {};
            activities.forEach(act => {
                const hour = new Date(act.start).getHours();
                hourCounts[hour] = (hourCounts[hour] || 0) + 1;
            });
            
            const peakHour = Object.keys(hourCounts).reduce((a, b) => 
                hourCounts[a] > hourCounts[b] ? a : b, '0');
            const peakHours = `${peakHour}:00 - ${parseInt(peakHour) + 1}:00`;
            
            const avgSession = activities.length > 0 ? 
                Math.round(activities.reduce((sum, act) => sum + (act.dauer || 0), 0) / activities.length / (1000 * 60)) : 0;
            
            // Simulate advanced metrics
            const focusScore = Math.round(7 + Math.random() * 3);
            const motivationIndex = Math.round(75 + Math.random() * 20);
            const stressLevel = Math.round(1 + Math.random() * 2);
            const deepWork = Math.round(60 + Math.random() * 25);
            const multitasking = Math.round(15 + Math.random() * 15);
            const flowState = Math.round(45 + Math.random() * 30);
            const growthPotential = Math.round(15 + Math.random() * 25);
            const burnoutRisk = Math.round(Math.random() * 40);
            const routineStability = Math.round(6 + Math.random() * 4);
            
            // Generate AI recommendations
            const aiRecommendations = [
                {
                    icon: '‚è∞',
                    title: 'Optimiere deine Prime Time',
                    description: `Deine produktivste Zeit ist zwischen ${peakHours}. Plane wichtige Tasks in diesen Zeitraum f√ºr maximale Effizienz.`,
                    priority: 'high',
                    impact: 'Hoch'
                },
                {
                    icon: 'üéØ',
                    title: 'Fokuszeit verl√§ngern',
                    description: `Deine durchschnittliche Session-L√§nge von ${avgSession} Minuten kann durch 25-Minuten-Pomodoro-Zyklen optimiert werden.`,
                    priority: 'medium',
                    impact: 'Mittel'
                },
                {
                    icon: 'üí™',
                    title: userSuffix === 'A' ? 'Gamedev-Balance verbessern' : 'Sport-Integration verst√§rken',
                    description: userSuffix === 'A' ? 
                        'Mehr kreative Gamedev-Sessions k√∂nnen Trading-Stress reduzieren und neue Perspektiven schaffen.' :
                        'Regelm√§√üige Sporteinheiten zwischen Trading-Sessions verbessern mentale Klarheit und Entscheidungsf√§higkeit.',
                    priority: 'medium',
                    impact: 'Hoch'
                },
                {
                    icon: 'üìà',
                    title: 'Datenbasierte Routine-Anpassung',
                    description: `Basierend auf deiner Performance-Analyse empfehlen wir eine Routine-Anpassung f√ºr ${growthPotential}% mehr Produktivit√§t.`,
                    priority: 'low',
                    impact: 'Hoch'
                }
            ];
            
            return {
                peakHours,
                avgSession: `${avgSession} Minuten`,
                bestDays: 'Dienstag, Mittwoch, Donnerstag',
                energyTrend: 'Stabil steigend',
                focusScore,
                motivationIndex,
                stressLevel,
                deepWork,
                multitasking,
                flowState,
                growthPotential,
                optimalBreak: 'Alle 90 Minuten',
                burnoutRisk,
                routineStability,
                aiRecommendations
            };
        }

        // Smart Analysis Function (placeholder for original function)
        async function showIntelligentAnalysis(userSuffix, userName) {
            // This would be the original intelligent analysis from the original code
            showDeepAnalysis(userSuffix, userName);
        }

        // UI Event Handlers
        function updateChart(chartId, timeframe) {
            // Update chart based on timeframe
            const buttons = document.querySelectorAll(`[onclick*="${chartId}"]`);
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Simulate chart update
            console.log(`Updating ${chartId} for ${timeframe}`);
        }

        function updateActivities(suffix, sortType) {
            const buttons = document.querySelectorAll(`[onclick*="updateActivities('${suffix}'"]`);
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Re-sort and display activities based on sortType
            const activities = userActivities[suffix] || [];
            let sortedActivities = [...activities];
            
            switch(sortType) {
                case 'longest':
                    sortedActivities.sort((a, b) => (b.dauer || 0) - (a.dauer || 0));
                    break;
                case 'productive':
                    // Simulate productivity scoring
                    sortedActivities.sort((a, b) => Math.random() - 0.5);
                    break;
                default: // recent
                    sortedActivities.sort((a, b) => new Date(b.start) - new Date(a.start));
            }
            
            displayActivities(suffix, sortedActivities.slice(0, 10));
        }

        function refreshDeepAnalysis() {
            const user = document.getElementById('deepAnalysisUser').value;
            const period = document.getElementById('deepAnalysisPeriod').value;
            const activity = document.getElementById('deepAnalysisActivity').value;
            
            showLoadingOverlay("Aktualisiere Tiefenanalyse...");
            
            setTimeout(() => {
                generateHeatmap();
                generateCorrelationMatrix();
                generateTopSessions();
                hideLoadingOverlay();
            }, 1500);
        }

        function updatePredictions() {
            calculatePredictions();
        }

        function updateBenchmarks() {
            // Refresh benchmark charts if needed
            console.log('Updating benchmarks...');
        }

        // Export Functions
        let selectedExportFormat = null;

        function selectExportOption(format) {
            document.querySelectorAll('.export-option').forEach(opt => opt.classList.remove('selected'));
            event.target.closest('.export-option').classList.add('selected');
            selectedExportFormat = format;
        }

        function executeExport() {
            if (!selectedExportFormat) {
                alert('Bitte w√§hlen Sie ein Export-Format aus.');
                return;
            }
            
            showLoadingOverlay(`Exportiere Daten als ${selectedExportFormat.toUpperCase()}...`);
            
            setTimeout(() => {
                // Simulate export
                const data = {
                    timestamp: new Date().toISOString(),
                    format: selectedExportFormat,
                    users: Object.keys(userData),
                    totalHours: Object.values(userData).reduce((sum, user) => sum + user.totalHours, 0),
                    activities: Object.values(allUserActivities).flat().length
                };
                
                const filename = `dashboard-export-${new Date().toISOString().slice(0, 10)}.${selectedExportFormat}`;
                
                if (selectedExportFormat === 'json') {
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.click();
                    URL.revokeObjectURL(url);
                } else {
                    // For other formats, show completion message
                    alert(`Export als ${selectedExportFormat.toUpperCase()} wurde erfolgreich erstellt: ${filename}`);
                }
                
                hideLoadingOverlay();
            }, 2000);
        }

        function exportUserData(userSuffix) {
            const userData = userData[userSuffix];
            if (!userData) {
                alert('Keine Daten f√ºr diesen Benutzer verf√ºgbar.');
                return;
            }
            
            showLoadingOverlay("Exportiere Benutzerdaten...");
            
            setTimeout(() => {
                const exportData = {
                    user: userSuffix,
                    exportDate: new Date().toISOString(),
                    stats: {
                        totalHours: userData.totalHours,
                        activeDays: userData.allDates.length,
                        activities: userData.allActivities.length
                    },
                    activities: userData.allActivities
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `user-${userSuffix}-export-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                hideLoadingOverlay();
            }, 1000);
        }

        // Modal Management
        function closeAnalysis() {
            document.getElementById('analysisModal').classList.remove('show');
        }

        // Logout Function
        function logout() {
            if (confirm('M√∂chten Sie sich wirklich abmelden?')) {
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                });
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            document.getElementById('analysisModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAnalysis();
                }
            });

            // Close modal with escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAnalysis();
                }
            });
        });

        // Export functions to global scope
        window.switchTab = switchTab;
        window.showDeepAnalysis = showDeepAnalysis;
        window.showIntelligentAnalysis = showIntelligentAnalysis;
        window.closeAnalysis = closeAnalysis;
        window.logout = logout;
        window.updateChart = updateChart;
        window.updateActivities = updateActivities;
        window.refreshDeepAnalysis = refreshDeepAnalysis;
        window.selectExportOption = selectExportOption;
        window.executeExport = executeExport;
        window.exportUserData = exportUserData;
    </script>
</body>
</html>
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        family: 'Inter',
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: colors.primary,
                                borderWidth: 1,
                                callbacks: {
                                    label: function (context) {
                                        return `${context.label}: ${context.parsed}h`;
                                    }
                                }
                            }
                        },
                        cutout: '60%',
                        animation: {
                            animateRotate: true,
                            duration: 2000
                        }
                    }
                });
            });
        }

        function createLineCharts() {
            ['A', 'B'].forEach(suffix => {
                const ctx = document.getElementById(`lineChart${suffix}`).getContext('2d');
                const data = userData[suffix];
                
                if (!data) return;

                const weekDays = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'];
                const tradingData = weekDays.map(day => {
                    const hours = data.weekData[day] ? formatHours(data.weekData[day].arbeit) : 0;
                    return parseFloat(hours);
                });
                
                const otherData = weekDays.map(day => {
                    const hours = data.weekData[day] ? formatHours(data.weekData[day].sport) : 0;
                    return parseFloat(hours);
                });

                chartInstances[`line${suffix}`] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: weekDays,
                        datasets: [
                            {
                                label: 'Trading',
                                data: tradingData,
                                borderColor: colors.warning,
                                backgroundColor: colors.warning + '20',
                                tension: 0.4,
                                pointBackgroundColor: colors.warning,
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                fill: true
                            },
                            {
                                label: suffix === 'A' ? 'Gamedev' : 'Sport',
                                data: otherData,
                                borderColor: suffix === 'A' ? colors.secondary : colors.success,
                                backgroundColor: (suffix === 'A' ? colors.secondary : colors.success) + '20',
                                tension: 0.4,
                                pointBackgroundColor: suffix === 'A' ? colors.secondary : colors.success,
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Stunden',
                                    font: {
                                        family: 'Inter',
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + 'h';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y}h`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            });
        }

        function createBarCharts() {
            ['A', 'B'].forEach(suffix => {
                const ctx = document.getElementById(`barChart${suffix}`).getContext('2d');
                const data = userData[suffix];
                
                if (!data) return;

                const lastDays = data.allDates.slice(-7);
                const chartData = lastDays.map(() => Math.random() * 6 + 2);

                chartInstances[`bar${suffix}`] = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: lastDays.map(date => new Date(date).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })),
                        datasets: [{
                            label: 'Stunden',
                            data: chartData,
                            backgroundColor: colors.primary,
                            borderRadius: 8,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Stunden'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutBounce'
                        }
                    }
                });
            });
        }

        function createSessionDistributionChart() {
            const ctx = document.getElementById('sessionDistributionChart').getContext('2d');
            
            // Sample data for session length distribution
            const sessionLengths = [
                { range: '0-30min', count: 15 },
                { range: '30-60min', count: 25 },
                { range: '1-2h', count: 30 },
                { range: '2-4h', count: 20 },
                { range: '4h+', count: 10 }
            ];

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sessionLengths.map(s => s.range),
                    datasets: [{
                        label: 'Anzahl Sessions',
                        data: sessionLengths.map(s => s.count),
                        backgroundColor: colors.gradients.primary.map(c => c + '80'),
                        borderColor: colors.primary,
                        borderWidth: 2,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Anzahl Sessions'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createTrendAnalysisChart() {
            const ctx = document.getElementById('trendAnalysisChart').getContext('2d');
            
            const trendData = {
                productivity: generateTrendData(75, 30),
                efficiency: generateTrendData(68, 30),
                consistency: generateTrendData(8.2, 30)
            };

            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Produktivit√§t (%)',
                            data: trendData.productivity,
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Effizienz (%)',
                            data: trendData.efficiency,
                            borderColor: colors.success,
                            backgroundColor: colors.success + '20',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Konsistenz (1-10)',
                            data: trendData.consistency.map(d => ({ x: d.x, y: d.y * 10 })),
                            borderColor: colors.warning,
                            backgroundColor: colors.warning + '20',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                            title: {
                                display: true,
                                text: 'Datum'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Wert'
                            }
                        }
                    },
                    plugins: {