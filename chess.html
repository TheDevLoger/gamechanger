<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <title>Online Schachspiel</title>
    <style>
        body {
            font-family: "Segoe UI Symbol", "Arial Unicode MS", Arial, sans-serif;
            text-align: center;
            background: #f0f0f0;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            margin: 20px auto;
            border: 2px solid #333;
        }

        .square {
            width: 60px;
            height: 60px;
            font-size: 48px;
            line-height: 60px;
            text-align: center;
            user-select: none;
            cursor: pointer;
        }

        .white {
            background: #eee;
        }

        .black {
            background: #999;
        }

        .selected {
            outline: 3px solid red;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Online Schach</h1>
    <div id="board"></div>
    <button id="joinGame">Spiel beitreten</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAujeUok4jKYwnr5GEXze_EadszqMdY1y4",
            authDomain: "gamechanger-78fb4.firebaseapp.com",
            databaseURL: "https://console.firebase.google.com/u/0/project/gamechanger-78fb4/database/gamechanger-78fb4-default-rtdb/data/~2F",
            projectId: "gamechanger-78fb4",
            storageBucket: "gamechanger-78fb4.firebasestorage.app",
            messagingSenderId: "510513691722",
            appId: "1:510513691722:web:c0c1a97141ddfda4377ab3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const gameRef = ref(db, "chessgame/board");

        const initialBoard = [
            ["♜", "♞", "♝", "♛", "♚", "♝", "♞", "♜"],
            ["♟", "♟", "♟", "♟", "♟", "♟", "♟", "♟"],
            ["", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", ""],
            ["♙", "♙", "♙", "♙", "♙", "♙", "♙", "♙"],
            ["♖", "♘", "♗", "♕", "♔", "♗", "♘", "♖"],
        ];

        let boardState = structuredClone(initialBoard);
        let selected = null;
        let playerColor = "white";

        const boardEl = document.getElementById("board");

        function drawBoard(state) {
            boardEl.innerHTML = "";
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement("div");
                    square.className = "square " + ((row + col) % 2 === 0 ? "white" : "black");
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.textContent = state[row][col];
                    if (selected && selected.row === row && selected.col === col) {
                        square.classList.add("selected");
                    }
                    square.addEventListener("click", onSquareClick);
                    boardEl.appendChild(square);
                }
            }
        }

        function onSquareClick(e) {
            const row = +e.target.dataset.row;
            const col = +e.target.dataset.col;
            if (!selected) {
                if (boardState[row][col] !== "") {
                    selected = { row, col };
                    drawBoard(boardState);
                }
            } else {
                const from = selected;
                const to = { row, col };
                movePiece(from, to);
                selected = null;
            }
        }

        function movePiece(from, to) {
            const piece = boardState[from.row][from.col];
            boardState[to.row][to.col] = piece;
            boardState[from.row][from.col] = "";
            set(gameRef, boardState);
        }

        onValue(gameRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                boardState = data;
                drawBoard(boardState);
            } else {
                set(gameRef, boardState);
            }
        });

        document.getElementById("joinGame").addEventListener("click", () => {
            playerColor = prompt("Weiß oder Schwarz spielen? (white/black)", "white");
        });
    </script>
</body>
</html>
